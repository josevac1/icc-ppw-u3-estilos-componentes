import{f as R,h as I,j as N,l as U,q as $,s as k}from"./chunk-Y2XIJCR6.js";import{i as w,k as T,r as y}from"./chunk-QTMV7BX7.js";import{Ab as P,Gb as b,Jb as g,Lb as m,Ra as l,Tb as o,Ub as v,Vb as C,_ as p,da as _,ea as x,gb as S,lb as A,na as E,q as h,sb as c,tb as u,vb as D,wb as F,xb as f,yb as t,zb as n}from"./chunk-IWYHIMNY.js";var M=(e,i)=>i.uid;function z(e,i){e&1&&(t(0,"tr")(1,"td",16),P(2,"span",17),t(3,"p",18),o(4,"Cargando usuarios..."),n()()())}function j(e,i){e&1&&(t(0,"span",23),o(1,"T\xFA"),n())}function B(e,i){e&1&&(t(0,"div",28),o(1," \u{1F451} ADMIN "),n())}function G(e,i){e&1&&(t(0,"div",29),o(1," \u{1F464} Usuario "),n())}function O(e,i){if(e&1){let a=b();t(0,"button",32),g("click",function(){_(a);let r=m(2).$implicit,s=m();return x(s.toggleRole(r))}),o(1," \u2B06\uFE0F Ascender "),n()}}function L(e,i){if(e&1){let a=b();t(0,"button",33),g("click",function(){_(a);let r=m(2).$implicit,s=m();return x(s.toggleRole(r))}),o(1," \u2B07\uFE0F Degradar "),n()}}function q(e,i){if(e&1&&c(0,O,2,0,"button",30)(1,L,2,0,"button",31),e&2){let a=m().$implicit;u(a.role==="user"?0:1)}}function H(e,i){e&1&&(t(0,"span",27),o(1,"No editable"),n())}function J(e,i){if(e&1&&(t(0,"tr",15)(1,"td")(2,"div",19)(3,"div",20)(4,"div",21)(5,"span"),o(6),n()()(),t(7,"div")(8,"div",22),o(9),c(10,j,2,0,"span",23),n()()()(),t(11,"td"),A(12,B,2,0,"div",24)(13,G,2,0,"div",25),n(),t(14,"td",26),o(15),n(),t(16,"td",14),c(17,q,2,1)(18,H,2,0,"span",27),n()()),e&2){let a,d,r=i.$implicit,s=m();l(6),v(r.email.charAt(0).toUpperCase()),l(3),C(" ",r.email," "),l(),u(r.uid===((a=s.authService.currentUser())==null?null:a.uid)?10:-1),l(2),f("ngIf",r.role==="admin"),l(),f("ngIf",r.role==="user"),l(2),C(" ",r.uid," "),l(2),u(r.uid!==((d=s.authService.currentUser())==null?null:d.uid)?17:18)}}var V=class e{firestore=p(R);authService=p(k);reloadTrigger=E(0);usersResource=y({params:()=>({reload:this.reloadTrigger()}),stream:()=>{let i=N(this.firestore,"users");return I(i,{idField:"uid"})}});toggleRole(i){if(i.uid===this.authService.currentUser()?.uid){alert("No puedes cambiar tu propio rol.");return}let a=i.role==="admin"?"user":"admin";if(!confirm(`\xBFEst\xE1s seguro de ${a==="admin"?"ASCENDER":"DEGRADAR"} a ${i.email}?`))return;let r=U(this.firestore,"users",i.uid);h($(r,{role:a})).subscribe({next:()=>{console.log(`Rol actualizado a ${a}`)},error:s=>{console.error(s),alert("Error al actualizar rol: Posiblemente falta de permisos en firestore.rules")}})}static \u0275fac=function(a){return new(a||e)};static \u0275cmp=S({type:e,selectors:[["app-admin-panel"]],decls:31,vars:2,consts:[[1,"p-8","min-h-screen","bg-base-200"],[1,"max-w-6xl","mx-auto"],[1,"flex","flex-col","md:flex-row","justify-between","items-center","mb-8","gap-4"],[1,"text-3xl","font-bold","text-primary","flex","items-center","gap-2"],[1,"text-base-content/70","mt-1"],[1,"stats","shadow","bg-base-100"],[1,"stat"],[1,"stat-title"],[1,"stat-value","text-secondary"],[1,"card","bg-base-100","shadow-xl","overflow-hidden"],[1,"overflow-x-auto"],[1,"table","table-zebra","w-full"],[1,"bg-base-300"],[1,"hidden","md:table-cell"],[1,"text-right"],[1,"hover"],["colspan","4",1,"text-center","py-8"],[1,"loading","loading-spinner","loading-lg","text-primary"],[1,"mt-2","text-sm","opacity-50"],[1,"flex","items-center","gap-3"],[1,"avatar","placeholder"],[1,"bg-neutral","text-neutral-content","rounded-full","w-10"],[1,"font-bold"],[1,"badge","badge-xs","badge-info","ml-2"],["class","badge badge-primary gap-2 font-bold",4,"ngIf"],["class","badge badge-ghost gap-2",4,"ngIf"],[1,"hidden","md:table-cell","font-mono","text-xs","opacity-50"],[1,"text-xs","text-base-content/40","italic","pr-2"],[1,"badge","badge-primary","gap-2","font-bold"],[1,"badge","badge-ghost","gap-2"],[1,"btn","btn-sm","btn-success","text-white"],[1,"btn","btn-sm","btn-error","btn-outline"],[1,"btn","btn-sm","btn-success","text-white",3,"click"],[1,"btn","btn-sm","btn-error","btn-outline",3,"click"]],template:function(a,d){if(a&1&&(t(0,"div",0)(1,"div",1)(2,"div",2)(3,"div")(4,"h1",3),o(5," \u{1F6E1}\uFE0F Panel de Administraci\xF3n "),n(),t(6,"p",4),o(7,"Gestiona los permisos y roles de los usuarios"),n()(),t(8,"div",5)(9,"div",6)(10,"div",7),o(11,"Total Usuarios"),n(),t(12,"div",8),o(13),n()()()(),t(14,"div",9)(15,"div",10)(16,"table",11)(17,"thead",12)(18,"tr")(19,"th"),o(20,"Usuario"),n(),t(21,"th"),o(22,"Rol Actual"),n(),t(23,"th",13),o(24,"ID de Sistema"),n(),t(25,"th",14),o(26,"Acciones"),n()()(),t(27,"tbody"),c(28,z,5,0,"tr"),D(29,J,19,7,"tr",15,M),n()()()()()()),a&2){let r;l(13),v(((r=d.usersResource.value())==null?null:r.length)||0),l(15),u(d.usersResource.isLoading()?28:-1),l(),F(d.usersResource.value())}},dependencies:[T,w],encapsulation:2})};export{V as AdminPanelComponent};
