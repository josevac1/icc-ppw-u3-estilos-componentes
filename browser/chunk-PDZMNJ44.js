import{a as we,b as oe,c as De,d as Te,e as Ne,f as Me,g as Ve,h as Ae,i as Ie,j as je,k as Re}from"./chunk-QQ5PLT2P.js";import{a as Le}from"./chunk-4ESZZJKE.js";import{g as _e,j as O,m as be}from"./chunk-H4444JOE.js";import{e as he,f as Fe,i as Se,j as ie,k as Ee,l as ne,m as Ce,o as Pe,q as ye,r as ke,s as U}from"./chunk-Y2XIJCR6.js";import{k as fe,p as xe,r as j}from"./chunk-QTMV7BX7.js";import{Ab as F,Bb as c,Cb as p,D as B,Db as ee,Gb as T,Hb as me,Jb as g,Lb as m,Oa as q,P as z,Pb as ce,Ra as s,Rb as G,Sb as de,Tb as r,Ub as S,V as $,Vb as N,Wb as pe,Yb as y,Zb as I,_ as v,_b as ue,a as Y,b as Z,da as f,dc as H,ea as _,ec as ge,fa as V,fc as te,ga as A,gb as P,gc as ve,kc as k,na as b,q as M,r as C,sb as x,tb as h,ub as le,v as R,vb as w,wb as D,xb as u,yb as o,zb as a}from"./chunk-IWYHIMNY.js";var J=class i{activatedRoute=v(_e);currentPage=xe(this.activatedRoute.queryParamMap.pipe(R(t=>t.get("page")?+t.get("page"):1),R(t=>isNaN(t)?1:t)),{initialValue:1});static \u0275fac=function(e){return new(e||i)};static \u0275prov=$({token:i,factory:i.\u0275fac,providedIn:"root"})};var ae=()=>[],re=i=>({page:i});function $e(i,t){if(i&1){let e=T();o(0,"button",3),g("click",function(){let l=f(e).$implicit,d=m();return _(d.activePage.set(l))}),r(1),a()}if(i&2){let e=t.$implicit,n=m();G("btn-primary",e===n.activePage()),u("routerLink",y(5,ae))("queryParams",I(6,re,e)),s(),N(" ",e," ")}}var K=class i{pages=k(0);currentPage=k(1);activePage=ve(this.currentPage);getPagesList=ge(()=>{let t=this.pages(),e=this.activePage();if(t<=5)return Array.from({length:t},(d,E)=>E+1);let n=Math.max(1,e-2),l=Math.min(t,n+4);return Array.from({length:l-n+1},(d,E)=>n+E)});previousPage(){this.activePage()>1&&this.activePage.update(t=>t-1)}nextPage(){this.activePage()<this.pages()&&this.activePage.update(t=>t+1)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=P({type:i,selectors:[["app-pagination-component"]],inputs:{pages:[1,"pages"],currentPage:[1,"currentPage"]},decls:7,vars:12,consts:[[1,"join","flex","justify-center","items-center","gap-2"],[1,"join-item","btn",3,"click","routerLink","queryParams","disabled"],[1,"join-item","btn",3,"btn-primary","routerLink","queryParams"],[1,"join-item","btn",3,"click","routerLink","queryParams"]],template:function(e,n){e&1&&(o(0,"div",0)(1,"button",1),g("click",function(){return n.previousPage()}),r(2,"\xAB"),a(),w(3,$e,2,8,"button",2,le),o(5,"button",1),g("click",function(){return n.nextPage()}),r(6,"\xBB"),a()()),e&2&&(s(),u("routerLink",y(6,ae))("queryParams",I(7,re,n.activePage()-1))("disabled",n.activePage()===1),s(2),D(n.getPagesList()),s(2),u("routerLink",y(9,ae))("queryParams",I(10,re,n.activePage()+1))("disabled",n.activePage()===n.pages()))},dependencies:[O],encapsulation:2,changeDetection:0})};var Q=class i{simpsonsCount=k.required();totalPages=k.required();static \u0275fac=function(e){return new(e||i)};static \u0275cmp=P({type:i,selectors:[["app-hero-simpsons"]],inputs:{simpsonsCount:[1,"simpsonsCount"],totalPages:[1,"totalPages"]},decls:28,vars:2,consts:[["role","banner",1,"hero","bg-linear-to-r","from-yellow-400","via-yellow-500","to-orange-400","text-base-content"],[1,"hero-content","text-center","py-12"],[1,"max-w-md"],[1,"text-5xl","font-bold","text-black","drop-shadow-md"],[1,"py-6","text-lg","text-gray-800","font-medium"],[1,"stats","stats-horizontal","shadow-lg","bg-white/90"],[1,"stat"],[1,"stat-figure","text-primary"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"inline-block","w-8","h-8","stroke-current"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0zM7 10a2 2 0 11-4 0 2 2 0z"],[1,"stat-title","text-gray-700"],[1,"stat-value","text-primary"],[1,"stat-desc","text-gray-600"],[1,"stat-figure","text-secondary"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"],[1,"stat-value","text-secondary"]],template:function(e,n){e&1&&(c(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),r(4,"Simpsons"),p(),c(5,"p",4),r(6," Explora el universo de la familia m\xE1s famosa de Springfield "),p(),c(7,"div",5)(8,"div",6)(9,"div",7),V(),c(10,"svg",8),ee(11,"path",9),p()(),A(),c(12,"div",10),r(13,"Personajes"),p(),c(14,"div",11),r(15),p(),c(16,"div",12),r(17,"Total de registros"),p()(),c(18,"div",6)(19,"div",13),V(),c(20,"svg",8),ee(21,"path",14),p()(),A(),c(22,"div",10),r(23,"P\xE1ginas"),p(),c(24,"div",15),r(25),p(),c(26,"div",12),r(27,"Total disponibles"),p()()()()()()),e&2&&(s(15),N(" ",n.simpsonsCount()," "),s(10),S(n.totalPages()))},encapsulation:2,changeDetection:0})};var qe=(i,t)=>t.label;function Ge(i,t){if(i&1&&(c(0,"a",1),r(1),p()),i&2){let e=m().$implicit;me("href",e.link,q),s(),S(e.label)}}function He(i,t){if(i&1&&(c(0,"span"),r(1),p()),i&2){let e=m().$implicit;s(),S(e.label)}}function Oe(i,t){if(i&1&&(c(0,"li"),x(1,Ge,2,2,"a",1)(2,He,2,1,"span"),p()),i&2){let e=t.$implicit;s(),h(e.link?1:2)}}var W=class i{items=k([]);static \u0275fac=function(e){return new(e||i)};static \u0275cmp=P({type:i,selectors:[["app-breadcrumbs"]],inputs:{items:[1,"items"]},decls:4,vars:0,consts:[[1,"breadcrumbs","text-sm","px-6","py-3","bg-base-200"],[1,"link","link-hover",3,"href"]],template:function(e,n){e&1&&(c(0,"div",0)(1,"ul"),w(2,Oe,3,1,"li",null,qe),p()()),e&2&&(s(2),D(n.items()))},encapsulation:2,changeDetection:0})};var X=class i{firestore=v(Fe);authService=v(U);favorites=b([]);loading=b(!1);addFavorite(t,e,n){let l=this.authService.currentUser();if(!l)throw new Error("Usuario no autenticado");let d={nombre:t,customName:n||t,image:e,userId:l.uid,createdAt:new Date},E=ie(this.firestore,"favorites");return M(Se(E,Z(Y({},d),{createdAt:he.fromDate(d.createdAt)})))}getFavorites(){let t=this.authService.currentUser();if(!t)return M([[]]);this.loading.set(!0);let e=ie(this.firestore,"favorites"),n=Pe(e,ke("userId","==",t.uid));return M(Ce(n)).pipe(R(l=>{let d=l.docs.map(E=>Z(Y({id:E.id},E.data()),{createdAt:E.data().createdAt.toDate()}));return this.favorites.set(d),this.loading.set(!1),d}))}updateFavorite(t,e){let n=ne(this.firestore,"favorites",t);return M(ye(n,{customName:e}))}deleteFavorite(t){let e=ne(this.firestore,"favorites",t);return M(Ee(e))}isFavorite(t){return this.favorites().some(e=>e.nombre===t)}static \u0275fac=function(e){return new(e||i)};static \u0275prov=$({token:i,factory:i.\u0275fac,providedIn:"root"})};var Ue=()=>({label:"Inicio",link:"/"}),Je=()=>({label:"Simpsons",link:"/simpsons"}),Ke=()=>({label:"Personajes"}),Qe=(i,t,e)=>[i,t,e],We=i=>["/simpsons",i],ze=(i,t)=>t.id;function Xe(i,t){i&1&&(o(0,"div",4),F(1,"span",17),a())}function Ye(i,t){i&1&&(o(0,"div",5),V(),o(1,"svg",18),F(2,"path",19),a(),A(),o(3,"span"),r(4,"Error cargando personajes. Revisa la consola (F12)."),a()())}function Ze(i,t){if(i&1){let e=T();o(0,"div",6)(1,"select",20,0),g("change",function(){f(e);let l=ce(2),d=m();return _(d.charactersPerPage.set(+l.value))}),o(3,"option",21),r(4,"10"),a(),o(5,"option",22),r(6,"20"),a(),o(7,"option",23),r(8,"50"),a(),o(9,"option",24),r(10,"100"),a()(),F(11,"app-pagination-component",25)(12,"div",26),a()}if(i&2){let e=m();s(11),u("pages",e.totalPages())("currentPage",e.paginationService.currentPage())}}function et(i,t){i&1&&(o(0,"button",30),r(1," \u2B50 Guardado "),a())}function tt(i,t){if(i&1){let e=T();o(0,"button",32),g("click",function(){f(e);let l=m().$implicit,d=m(2);return _(d.addToFavorites(l))}),r(1," \u2606 Agregar "),a()}}function it(i,t){if(i&1&&(o(0,"tr")(1,"td"),r(2),a(),o(3,"td",28),r(4),a(),o(5,"td"),r(6),a(),o(7,"td")(8,"span"),r(9),a()(),o(10,"td")(11,"a",29),r(12," Ver Detalle "),a()(),o(13,"td"),x(14,et,2,0,"button",30)(15,tt,2,0,"button",31),a()()),i&2){let e=t.$implicit,n=m(2);s(2),S(e.id),s(2),S(e.name),s(2),S(e.occupation),s(2),de(pe("badge badge-",e.status==="Alive"?"success":"error")),s(),N(" ",e.status," "),s(2),u("routerLink",I(9,We,e.id)),s(3),h(n.isFavorite(e.name)?14:15)}}function nt(i,t){if(i&1&&(o(0,"div",7)(1,"table",27)(2,"thead")(3,"tr")(4,"th"),r(5,"ID"),a(),o(6,"th"),r(7,"Nombre"),a(),o(8,"th"),r(9,"Ocupaci\xF3n"),a(),o(10,"th"),r(11,"Estado"),a(),o(12,"th"),r(13,"Detalles"),a(),o(14,"th"),r(15,"Favorito"),a()()(),o(16,"tbody"),w(17,it,16,11,"tr",null,ze),a()()()),i&2){let e=m();s(17),D(e.simpsonsResource.value().results)}}function ot(i,t){i&1&&F(0,"span",13)}function at(i,t){i&1&&r(0," \u{1F504} Actualizar ")}function rt(i,t){i&1&&(o(0,"div",14),F(1,"span",33),a())}function st(i,t){i&1&&(o(0,"div",15),V(),o(1,"svg",34),F(2,"path",35),a(),A(),o(3,"span"),r(4,"No tienes favoritos a\xFAn. \xA1Agrega algunos personajes de la tabla de arriba!"),a()())}function lt(i,t){if(i&1){let e=T();o(0,"form",41)(1,"input",42),g("keyup.enter",function(){f(e);let l=m(3);return _(l.saveEditedFavorite())})("keyup.escape",function(){f(e);let l=m(3);return _(l.cancelEditingFavorite())}),a(),o(2,"div",43)(3,"button",44),g("click",function(){f(e);let l=m(3);return _(l.saveEditedFavorite())}),r(4," \u2713 Guardar "),a(),o(5,"button",45),g("click",function(){f(e);let l=m(3);return _(l.cancelEditingFavorite())}),r(6," \u2715 Cancelar "),a()()()}if(i&2){let e,n=m(3);u("formGroup",n.editForm),s(),G("input-error",((e=n.editForm.get("customName"))==null?null:e.invalid)&&((e=n.editForm.get("customName"))==null?null:e.touched)),s(2),u("disabled",n.editForm.invalid)}}function mt(i,t){if(i&1){let e=T();o(0,"p",46)(1,"span",47),r(2,"Alias:"),a(),F(3,"br"),r(4),a(),o(5,"div",48)(6,"button",49),g("click",function(){f(e);let l=m().$implicit,d=m(2);return _(d.startEditingFavorite(l))}),r(7," \u270F\uFE0F Editar "),a(),o(8,"button",50),g("click",function(){f(e);let l=m().$implicit,d=m(2);return _(d.removeFromFavorites(l.id))}),r(9," \u{1F5D1}\uFE0F Eliminar "),a()()}if(i&2){let e=m().$implicit;s(4),N(" ",e.customName," ")}}function ct(i,t){if(i&1&&(o(0,"div",36)(1,"figure",37),F(2,"img",38),a(),o(3,"div",39)(4,"h3",40),r(5),a(),x(6,lt,7,4,"form",41)(7,mt,10,1),a()()),i&2){let e=t.$implicit,n=m(2);s(2),u("src",e.image,q)("alt",e.nombre),s(3),S(e.nombre),s(),h(n.editingFavoriteId()===e.id?6:7)}}function dt(i,t){if(i&1&&(o(0,"div",16),w(1,ct,8,4,"div",36,ze),a()),i&2){let e=m();s(),D(e.favorites())}}var Be=class i{simpsonsService=v(Le);paginationService=v(J);favoritesService=v(X);authService=v(U);addFavoriteAction=b(null);deleteFavoriteAction=b(null);updateFavoriteAction=b(null);charactersPerPage=b(10);totalPages=b(0);constructor(){te(()=>{this.simpsonsResource.hasValue()&&this.totalPages.set(this.simpsonsResource.value().pages)}),this.editForm=this.fb.group({customName:["",[oe.required,oe.minLength(2)]]}),te(()=>{this.authService.currentUser()&&this.reloadFavoritesTrigger.update(e=>e+1)})}simpsonsResource=j({params:()=>({page:this.paginationService.currentPage()-1,limit:this.charactersPerPage()}),stream:({params:t})=>this.simpsonsService.getCharactersOptions({offset:t.page,limit:t.limit})});fb=v(je);reloadFavoritesTrigger=b(0);favoritesResource=j({params:()=>({reload:this.reloadFavoritesTrigger()}),stream:({params:t})=>this.authService.currentUser()?this.favoritesService.getFavorites():C([])});addFavoriteResource=j({params:()=>this.addFavoriteAction(),stream:({params:t})=>t?this.favoritesService.addFavorite(t.nombre,t.imagen).pipe(z(()=>{H(()=>{this.reloadFavoritesTrigger.update(e=>e+1),alert("\xA1Agregado a favoritos!")})}),B(e=>(console.error("Error al agregar favorito:",e),alert("Error al agregar a favoritos: "+e.message),C(null)))):C(null)});deleteFavoriteResource=j({params:()=>this.deleteFavoriteAction(),stream:({params:t})=>t?this.favoritesService.deleteFavorite(t).pipe(z(()=>{H(()=>{this.reloadFavoritesTrigger.update(e=>e+1),alert("Eliminado de favoritos")})}),B(e=>(console.error("Error al eliminar favorito:",e),C(null)))):C(null)});updateFavoriteResource=j({params:()=>this.updateFavoriteAction(),stream:({params:t})=>t?this.favoritesService.updateFavorite(t.id,t.customName).pipe(z(()=>{H(()=>{this.reloadFavoritesTrigger.update(e=>e+1),this.cancelEditingFavorite(),alert("Nombre actualizado")})}),B(e=>(console.error("Error al actualizar favorito:",e),C(null)))):C(null)});editingFavoriteId=b(null);editForm;favorites=()=>this.favoritesResource.value()||[];loadingFavorites=this.favoritesResource.isLoading;reloadFavorites(){this.reloadFavoritesTrigger.update(t=>t+1)}addToFavorites(t){let e=t.name||t.character,n=t.image||"";if(!e){console.error("Nombre del personaje no encontrado"),alert("Error: No se pudo obtener el nombre del personaje");return}this.addFavoriteAction.set({nombre:e,imagen:n})}removeFromFavorites(t){confirm("\xBFEliminar de favoritos?")&&this.deleteFavoriteAction.set(t)}startEditingFavorite(t){this.editingFavoriteId.set(t.id),this.editForm.patchValue({customName:t.customName})}saveEditedFavorite(){if(this.editForm.invalid){this.editForm.markAllAsTouched();return}let t=this.editingFavoriteId(),e=this.editForm.value.customName;t&&e&&this.updateFavoriteAction.set({id:t,customName:e})}cancelEditingFavorite(){this.editingFavoriteId.set(null),this.editForm.reset()}isFavorite(t){return this.favorites().some(e=>e.nombre===t)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=P({type:i,selectors:[["app-simpsons-page"]],decls:18,vars:17,consts:[["selectPerPage",""],[1,"p-8"],[3,"items"],[3,"simpsonsCount","totalPages"],[1,"flex","justify-center","items-center","h-64"],[1,"alert","alert-error","my-4"],[1,"flex","gap-2","items-center","h-20","mb-4"],[1,"overflow-x-auto","mb-12"],[1,"divider"],[1,"mt-8"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-2xl","font-bold"],[1,"btn","btn-sm","btn-ghost",3,"click","disabled"],[1,"loading","loading-spinner","loading-sm"],[1,"flex","justify-center","items-center","py-12"],[1,"alert","alert-info"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-4"],[1,"loading","loading-spinner","loading-lg","text-primary"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"stroke-current","shrink-0","h-6","w-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"select","select-bordered","w-32",3,"change"],["value","10"],["value","20"],["value","50"],["value","100"],[3,"pages","currentPage"],[1,"flex","flex-1"],[1,"table","table-zebra"],[1,"font-bold"],[1,"btn","btn-sm","btn-primary",3,"routerLink"],["disabled","",1,"btn","btn-sm","btn-ghost","text-warning"],[1,"btn","btn-sm","btn-outline","btn-warning"],[1,"btn","btn-sm","btn-outline","btn-warning",3,"click"],[1,"loading","loading-spinner","loading-lg"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"stroke-current","shrink-0","w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"card","bg-base-100","shadow-xl","border","border-base-200"],[1,"px-4","pt-4"],["onerror","this.src='https://upload.wikimedia.org/wikipedia/commons/1/14/No_Image_Available.jpg'",1,"rounded-xl","h-48","w-full","object-contain","bg-base-200",3,"src","alt"],[1,"card-body"],[1,"card-title","text-sm"],[1,"form-control",3,"formGroup"],["type","text","formControlName","customName","placeholder","Nombre personalizado",1,"input","input-bordered","input-sm","mb-2",3,"keyup.enter","keyup.escape"],[1,"flex","gap-2"],["type","button",1,"btn","btn-xs","btn-success","flex-1",3,"click","disabled"],["type","button",1,"btn","btn-xs","btn-ghost","flex-1",3,"click"],[1,"text-xs","opacity-70"],[1,"font-semibold"],[1,"card-actions","justify-end","mt-2"],[1,"btn","btn-xs","btn-ghost",3,"click"],[1,"btn","btn-xs","btn-error","btn-outline",3,"click"]],template:function(e,n){if(e&1&&(o(0,"section",1),F(1,"app-breadcrumbs",2)(2,"app-hero-simpsons",3),x(3,Xe,2,0,"div",4),x(4,Ye,5,0,"div",5),x(5,Ze,13,2,"div",6),x(6,nt,19,0,"div",7),F(7,"div",8),o(8,"div",9)(9,"div",10)(10,"h2",11),r(11,"\u2B50 Mis Favoritos"),a(),o(12,"button",12),g("click",function(){return n.reloadFavorites()}),x(13,ot,1,0,"span",13)(14,at,1,0),a()(),x(15,rt,2,0,"div",14)(16,st,5,0,"div",15)(17,dt,3,0,"div",16),a()()),e&2){let l;s(),u("items",ue(13,Qe,y(10,Ue),y(11,Je),y(12,Ke))),s(),u("simpsonsCount",((l=n.simpsonsResource.value())==null?null:l.count)??0)("totalPages",n.totalPages()),s(),h(n.simpsonsResource.isLoading()?3:-1),s(),h(n.simpsonsResource.error()?4:-1),s(),h(n.simpsonsResource.hasValue()?5:-1),s(),h(n.simpsonsResource.hasValue()?6:-1),s(6),u("disabled",n.loadingFavorites()),s(),h(n.loadingFavorites()?13:14),s(2),h(n.loadingFavorites()?15:n.favorites().length===0?16:17)}},dependencies:[fe,be,O,K,Q,W,Re,Ne,Ae,Ie,we,De,Te,Me,Ve],encapsulation:2})};export{Be as SimpsonsPage};
